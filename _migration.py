import asyncio
import os

import aiogram.utils.exceptions as exc
import psycopg2
from aiogram.bot.bot import Bot

##############
# –ö–û–ù–§–ò–ì:
API_TOKEN = os.getenv('BOT_TOKEN')
if not API_TOKEN:
    print('—Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç')
    exit(-1)

DATABASE_URL = os.getenv('DATABASE_URL')
if not DATABASE_URL:
    print('—É—Ä–ª–∞ –±–¥ –Ω–µ—Ç')
    exit(-1)
##############

##############
# –ë–î
try:
    db = psycopg2.connect(DATABASE_URL, sslmode='require')
except Exception:
    db = None
    print('—É—Ä–ª–∞ –±–¥ –Ω–µ—Ç')
    exit(-1)

cursor = db.cursor()


def pre_process():
    full_names = dict()
    users_id = []

    # —Ç–∞—â–∏–º –≤—Å–µ –∞–π–¥–∏—à–Ω–∏–∫–∏ –∏–∑ –±–¥:
    cursor.execute("SELECT id from users")
    for i in cursor.fetchall():
        users_id.append(i[0])

    # —Å–æ–∑–¥–∞–µ–º –ë–î:
    cursor.execute("CREATE TABLE IF NOT EXISTS users(id BIGINT PRIMARY KEY, username TEXT, first_name TEXT, "
                   "last_name TEXT, full_name TEXT, join_date TIMESTAMP, messages INTEGER)")

    cursor.execute("CREATE TABLE IF NOT EXISTS messages(id BIGINT PRIMARY KEY, songs_ INTEGER, contacts_ INTEGER, "
                   "howto_ INTEGER, team_ INTEGER, memes_ INTEGER, credits_ INTEGER, help_ INTEGER, start_ INTEGER,"
                   "stop_ INTEGER, santa_ INTEGER, end_ INTEGER)")
    db.commit()

    ##############

    async def get_tg_names():
        b = Bot(token=API_TOKEN)
        for j in users_id:
            try:
                p = await b.get_chat_member(chat_id=-1001761177569, user_id=j)
            except exc.BadRequest:
                print('fail', j)
                continue
            full_names[p.user.id] = tuple(p.user.full_name.split())
        return

    loop = asyncio.get_event_loop()
    loop.run_until_complete(get_tg_names())
    loop.close()

    print(users_id)
    print(full_names)


FULL_NAMES = {1306294714: ('~—Ç–≤–æ—è', '–º–µ—Ä–∑–æ—Å—Ç—å.'), 912515292: ('–ê—Ä—Å–µ–Ω–∏–π',), 1202704228: ('–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', '–ì—Ä–µ–±—ë–Ω–∫–∏–Ω–∞'),
              626301983: ('–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞',), 418107034: ('–ö–∏—Ä–∏–ª–ª', '–ö—Ä—É–≥–ª–∏–∫–æ–≤'), 1242612463: ('kerauverk',),
              1827430974: ('nikki', 'vskrto'), 763718623: ("G'ayrat",), 1028047493: ('–ú–∞—Ä—É—Å—è', '–î–æ—â–µ—á–∫–∏–Ω–∞'),
              984835432: ('ü§çthevaleryü§ç',), 750857380: ('Sasha',), 859499774: ('barkosser',), 949449595: ('üêøÔ∏è',),
              915293518: ('Arisha', 'Kopylova'), 604181224: ('–ú–∞—Ç–≤–µ–π', '–Ø–Ω–≥–æ–ª–µ–Ω–∫–æ'),
              1839290151: ('Allergic', 'to', 'People'), 1038986109: ('–ê–Ω–Ω–∞', '–õ–∞–Ω—Å–∫–∏—Ö'),
              830920118: ('Aleksandr', 'Lopatko'), 684785002: ('Lena', 'D'), 1814854497: ('–ê–ª–∏–Ω–∞‚òÉÔ∏è',),
              1339387850: ('–°–æ—Ñ—å—è', '–ü–æ—à—É–∫–∞–π–ª–æ'), 1298918427: ('–ö–∞—Ç—è', '–ë–æ–µ–≤–∞'), 808864993: ('–ö—Å–µ–Ω–∏—è', '–ö–ª—é–µ–≤–∞'),
              421770409: ('–ê–ø–æ–ª–ª–∏–Ω–∞—Ä–∏—è',), 1371458078: ('–ò—Ä–∞',), 1167059277: ('Evgeha',), 476337160: ('–†–æ–º–∞–Ω', '–ö–æ–º–æ–≤'),
              925184312: ('Rish',), 713815827: ('–≥—Ä–∏—à–∞', '–∞–ª—Ñ—ë—Ä–æ–≤'), 1276954403: ('–ù–∏–∫–æ—à–∫–∞',),
              966452026: ('ullccceey',), 1180071373: ('irasubbotina_',), 886155515: ('Karina',),
              1044869530: ('–ú–∞–∫—Å–∏–º',), 1120695506: ('–î–∏–º–∞',), 824548117: ('–î–∞—à–∞',), 744431052: ('–ê–Ω—á–æ—É—Å', 'ü•∏'),
              1636551595: ('Lolita',), 1535110493: ('–ó—É–±–∫–æ–≤–∞', '–ü–æ–ª–∏–Ω–∞'), 800957236: ('–Ø–Ω–∞', '–õ—É–∫–∏–Ω–∞'),
              1652732836: ('–†–µ–Ω–∞—Ç–∞',), 1554349219: ('Huge', 'Cat'), 1866809913: ('–∫—Å—é—à–∞', '—Ö–ª–æ–ø–æ–≤–∞'),
              735035167: ('Polina', 'Nosevich'), 895841296: ('Voytenko',), 941543842: ('Pyankova', 'Polina'),
              1511045033: ('—Å–ª–∞–≤–∞ü§ô',), 992489503: ('Kristina', '‚Ä¢‚Ä¢‚Ä¢'), 1503877841: ('–ê–ª–∏—Å–∞',), 746600084: ('Matias',),
              1319044289: ('–Æ–ª—è', '–ê—Ä–±—É–∑–æ–≤–∞'), 827835673: ('–î–∏–∞–Ω–∞', '–ü–æ–ª—è–Ω—Å–∫–∞—è'), 1903810166: ('gay',),
              811742362: ('–ö–∞—Ä–∏–Ω–∞',), 972919938: ('–í–∞–ª–µ—Ä–∏—è', '–ì—É–∫–æ–≤–∞'), 524027591: ('Antonina',),
              1007940091: ('–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞', '–ö—É–∑—å–º–µ–Ω–∫–æ', 'ü§ç'), 670243686: ('üïä',), 1353175923: ('–ê–Ω–∞—Å—Ç–∞—Å–∏—è', '–°–µ–Ω–∏—á–∫–∏–Ω–∞'),
              888661591: ('Katrine',), 2128827002: ('–ö—Ä–∏—Å—Ç–∏–Ω–∞', 'makhoyni'), 970537793: ('Alina',),
              408444942: ('Peter', 'Lagutin'), 858518428: ('‚òÑ', 'Asmodeus', 'üî±'), 911640801: ('Anna', 'Klimenteva'),
              750119071: ('Anastasia', 'Millagher'), 1112547975: ('–î–∞–Ω–∏–∏–ª', '–ë–µ—Ä–¥—ã—à–µ–≤'),
              1299812194: ('–ö–∞—Ç—è', '–°–∏–¥–æ—Ä–æ–≤–∞'), 1329049699: ('valerolll',), 293182379: ('Svetlana',),
              1740178046: ('–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', '–ë–æ–µ–≤–∞'), 625991372: ('–î–µ–Ω–∏—Å', '–ë–∏—Ä—é–∫–æ–≤'), 1399973118: ('Rrincess', 'Bich'),
              1424975200: ('–ë–∏–∑',), 597583721: ('Phoenix‚Äôs',), 324242509: ('–ê—Ä—Å–µ–Ω–∏–π', '–ë–∏—Ä—é–∫–æ–≤'),
              575120780: ('–∫–æ–≤–∞–ª—å—Å–∫–∞—è-–¥–µ—Ñ–æ–ª—Ç–æ–≤–∞',), 608316796: ('s', 'o', 's'), 1832602820: ('–∞–Ω–Ω–∞', '—Å–µ–º—ã–∫–∏–Ω–∞'),
              1711263832: ('·Øì', 'ùë´ùë™', '|', '7ùó¢ùóóùóî‚úπ', '‚Éù‚Éôüá≤üáΩ'), 920248300: ('–º–∞—Ä–∏—è—Ä',), 1037353382: ('–¥–∞—à–∞', '–ø—Ä–æ'),
              499606837: ('Ylik', 'Zverüñá'), 175044465: ('Ioann', 'Chas'), 385056286: ('Dan', 'Sazonov'),
              407274643: ('Usman', 'Mughal'), 424185494: ('Vladislav', 'Kozub'), 1125531055: ('–ú–∏—Ö–∞–∏–ª', '–õ–æ–±—ã–Ω—Ü–µ–≤'),
              1070984836: ('Darya', 'Sergeevna'), 843464775: ('ùí¶‚Ñ¥ùìâ', '‚Ñ≥ùí∂ùìâùìá‚Ñ¥ùìàùìÄùíæùìÉüò°„ÉÑ‚úò'),
              1854799789: ('NVSPC', 'ADMIN'), 913289451: ('Baxora',), 500861553: ('M.M.M',),
              422419401: ('Stepan', 'Ikonnikov'), 439481645: ('.',), 622051454: ('–ê–ª–µ–Ω–∫–∞', '–¢–æ–∫—Å–∏–∫'),
              726058532: ('leramalyy',), 1399417506: ('–ö–∏—Ä–∞',)}
IDS = [1306294714, 912515292, 24, 1202704228, 626301983, 418107034, 1242612463, 1827430974, 763718623, 1028047493,
       984835432, 750857380, 859499774, 949449595, 915293518, 604181224, 1839290151, 1038986109, 830920118, 684785002,
       1814854497, 1339387850, 1298918427, 808864993, 421770409, 1371458078, 1167059277, 476337160, 925184312,
       713815827, 1276954403, 966452026, 1180071373, 886155515, 1044869530, 1120695506, 824548117, 744431052,
       1636551595, 1535110493, 800957236, 1652732836, 1554349219, 1866809913, 735035167, 895841296, 941543842,
       1511045033, 992489503, 1503877841, 746600084, 1319044289, 827835673, 1903810166, 811742362, 972919938, 524027591,
       1007940091, 670243686, 1353175923, 888661591, 2128827002, 970537793, 408444942, 858518428, 911640801, 750119071,
       1112547975, 1299812194, 1329049699, 293182379, 1740178046, 625991372, 1399973118, 1424975200, 597583721,
       324242509, 575120780, 608316796, 1832602820, 1711263832, 920248300, 1037353382, 499606837, 175044465, 385056286,
       407274643, 424185494, 1125531055, 1070984836, 843464775, 1854799789, 913289451, 500861553, 422419401, 439481645,
       622051454, 726058532, 1399417506]
NAMES = {1038986109: '–õ–∞–Ω—Å–∫–∏—Ö –ê–Ω–Ω–∞ –í–∞–ª–µ—Ä—å–µ–≤–Ω–∞', 830920118: '–õ–æ–ø–∞—Ç–∫–æ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≥–æ—Ä–µ–≤–∏—á',
         713815827: '–ê–ª—Ñ—ë—Ä–æ–≤ –ì—Ä–∏–≥–æ—Ä–∏–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á', 175044465: '–ß–∞—Å–æ–≤—Å–∫–∏—Ö –ò–≤–∞–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
         992489503: '–ê–≥–∏–±–∞–ª–æ–≤–∞ –ö—Ä–∏—Å—Ç–∏–Ω–∞ –°—Ç–∞–Ω–∏—Å–ª–∞–≤–æ–≤–Ω–∞', 1298918427: '–ë–æ–µ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ü–µ—Ç—Ä–æ–≤–Ω–∞',
         744431052: '–ö–∞–∑–∏–º–∏—Ä–∏–∫ –ê–Ω–Ω–∞ –î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞', 735035167: '–ù–æ—Å–µ–≤–∏—á –ü–æ–ª–∏–Ω–∞ –ü–µ—Ç—Ä–æ–≤–Ω–∞',
         1353175923: '–°–µ–Ω–∏—á–∫–∏–Ω–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è  –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', 824548117: '–®–∞—à–∫–æ–≤–∞ –î–∞—Ä—å—è –Æ—Ä—å–µ–≤–Ω–∞',
         941543842: '–ü—å—è–Ω–∫–æ–≤–∞ –ü–æ–ª–∏–Ω–∞ –ê–Ω–¥—Ä–µ–µ–≤–Ω–∞', 1167059277: '–ú–∞—Ä—Ç—ã–Ω–æ–≤–æ–π –ï–≤–≥–µ–Ω–∏–∏  –Æ—Ä—å–µ–≤–Ω—ã',
         1652732836: '–ö–∞–º–±–∞—Ä–æ–≤–∞ –†–µ–Ω–∞—Ç–∞ –ù–∞–∏–ª—å–µ–≤–Ω–∞', 1636551595: '–ü–æ–¥—à–∏–±—è–∫–∏–Ω–∞ –õ–æ–ª–∏—Ç–∞ –ù–∏–∫–æ–ª–∞–µ–≤–Ω–∞',
         920248300: '–ï—Ñ—Ä–µ–º–æ–≤–∞ –ú–∞—Ä–∏—è –†–æ–º–∞–Ω–æ–≤–Ω–∞', 499606837: '–ó–≤–µ—Ä–µ–≤–∞ –Æ–ª–∏—è –ï–≤–≥–µ–Ω—å–µ–≤–Ω–∞',
         1503877841: '–°–∞—Å–∏–Ω–∞ –ê–ª–∏—Å–∞ –ò–≥–æ—Ä–µ–≤–Ω–∞', 684785002: '–î—å—è—á–∫–æ–≤–∞ –ï–ª–µ–Ω–∞ –ú–∏—Ö–∞–π–ª–æ–≤–Ω–∞',
         726058532: '–ú–∞–ª—ã—Ö–∏–Ω–∞ –í–∞–ª–µ—Ä–∏—è –Æ—Ä—å–µ–≤–Ω–∞', 1070984836: '–ë–∞—É–ª–∏–Ω–∞ –î–∞—Ä—å—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞',
         1007940091: '–ö—É–∑—å–º–µ–Ω–∫–æ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', 670243686: '–ì–∞–ª–∏—á –ö—Å–µ–Ω–∏—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞',
         421770409: '–°–º–æ–ª—å—è–Ω–∏–Ω–æ–≤–∞ –ü–æ–ª–∏–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞', 1044869530: '–ú–∞—Ç–≤–µ–µ–≤ –ú–∞–∫—Å–∏–º –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
         886155515: '–ö–æ—Å—Ç–∏–Ω–∞ –ö–∞—Ä–∏–Ω–∞ –†–æ–º–∞–Ω–æ–≤–Ω–∞', 800957236: '–õ—É–∫–∏–Ω–∞ –Ø–Ω–∞ –ï–≤–≥–µ–Ω—å–µ–≤–Ω–∞',
         1112547975: '–ë–µ—Ä–¥—ã—à–µ–≤ –î–∞–Ω–∏–∏–ª –ò–≥–æ—Ä–µ–≤–∏—á', 895841296: '–í–æ–π—Ç–µ–Ω–∫–æ –í–ª–∞–¥–∏—Å–ª–∞–≤ –ê–Ω–¥—Ä–µ–µ–≤–∏—á',
         1180071373: '–°—É–±–±–æ—Ç–∏–Ω–∞ –ò—Ä–∏–Ω–∞ –ë–æ—Ä–∏—Å–æ–≤–Ω–∞', 1120695506: '–í–æ–¥–æ–ª–∞–¥ –î–º–∏—Ç—Ä–∏–π –í–ª–∞–¥–∏—Å–ª–∞–≤–æ–≤–∏—á',
         1399973118: '–ú–∞–∫–∞—Ä–µ–≤–∏—á –ò—Ä–∏–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞', 827835673: '–ü–æ–ª—è–Ω—Å–∫–∞—è –î–∏–∞–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞',
         1554349219: '–ì–æ–Ω–µ–µ–≤ –ú–∏—Ö–∞–∏–ª –°–µ—Ä–≥–µ–µ–≤–∏—á', 972919938: '–ì—É–∫–æ–≤–∞ –í–∞–ª–µ—Ä–∏—è –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞',
         970537793: '–¢–∞—Ä–∞–Ω–æ–≤–∞ –ê–ª–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', 911640801: '–ö–ª–∏–º–µ–Ω—Ç—å–µ–≤–∞ –ê–Ω–Ω–∞ –î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞',
         750119071: '–¢–∞—Ä–∞—Å–æ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞', 1299812194: '–°–∏–¥–æ—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ï–≤–≥–µ–Ω—å–µ–≤–Ω–∞',
         622051454: '–ë—Ä–∞–∂–Ω–∏–∫–æ–≤–∞ –ï–ª–µ–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', 1814854497: '–ë–æ—Ä–∑–µ–Ω–∫–æ–≤–∞ –ê–ª–∏–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞',
         1371458078: '–°–∞—Ñ–∞—Ç–æ–≤–∞ –ò—Ä–∏–Ω–∞ –í–∏—Ç–∞–ª—å–µ–≤–Ω–∞', 625991372: '–ë–∏—Ä—é–∫–æ–≤ –î–µ–Ω–∏—Å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
         808864993: '–ö–ª—é–µ–≤–∞ –ö—Å–µ–Ω–∏—è –ò–≤–∞–Ω–æ–≤–Ω–∞', 1511045033: '–°–æ–ª–Ω—Ü–µ–≤–∞ –Ø—Ä–æ—Å–ª–∞–≤–ª–∞ –ê–Ω–¥—Ä–µ–µ–≤–Ω–∞',
         811742362: '–ú–∞–∫–∞—Ä—å–µ–≤–∞ –ö–∞—Ä–∏–Ω–∞ –ê–ª–µ–∫—Å–µ–µ–≤–Ω–∞', 1329049699: '–®–µ–≤–ª—è–∫–æ–≤–∞ –í–∞–ª–µ—Ä–∏—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞',
         1740178046: '–ë–æ–µ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞', 385056286: '–°–∞–∑–æ–Ω–æ–≤ –î–∞–Ω–∏–∏–ª –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á'}


def process():
    # # —Å–æ–∑–¥–∞–µ–º –±–¥
    # cursor.execute("CREATE TABLE IF NOT EXISTS users(id BIGINT PRIMARY KEY, username TEXT, first_name TEXT, "
    #                "last_name TEXT, full_name TEXT, join_date TIMESTAMP, messages INTEGER)")
    #
    # cursor.execute("CREATE TABLE IF NOT EXISTS messages(id BIGINT PRIMARY KEY, songs_ INTEGER, contacts_ INTEGER, "
    #                "howto_ INTEGER, team_ INTEGER, memes_ INTEGER, credits_ INTEGER, help_ INTEGER, start_ INTEGER,"
    #                "stop_ INTEGER, santa_ INTEGER, end_ INTEGER)")
    # db.commit()

    users_write = []
    ans = dict()
    with open('santa_backup.csv', encoding='utf8') as f:
        for i in (f.readlines()[1:]):
            row = i.split(',')
            ans[int(row[0])] = row[1].rstrip('\n')
    print(ans)
    # with open('messages_backup.csv') as f:
    #     for i in (f.readlines()[1:]):
    #         row = i.split(',')
    #         names = list(FULL_NAMES[int(row[0])]) if len(FULL_NAMES[int(row[0])]) == 2 else list(FULL_NAMES[int(row[0])]) + ['']
    #         row = row[0:2] + names + row[2:-1] + [row[-1].strip('\n')]
    #         print(row)


process()
